---
title: "Greenspace Mapping"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

```


```{r libraries}

library(tidyverse)

```


```{r LoadData}
tracts_nature <- read_csv("data/nanda_parks_tract_2018_01P.csv")
tracts_to_zip <- read_csv("data/zcta_tract_rel_10.csv")
zips_of_interest <- read_csv("data/NaturalElementsSpatialAnalysis - ZipCodes.csv")
```


```{r ManipulateParkData}

tracts_nature_avg <-  
  tracts_nature %>%
  mutate(parks_per_area = count_open_parks / tract_area,
         GEOID = as.numeric(tract_fips10)
         ) %>%
  select(GEOID, parks_per_area, prop_park_area_tract)




```


```{r ZipParks}

zip_parks <-
  tracts_to_zip %>%
  
  select(ZipCode = ZCTA5, GEOID, ZAREA, ZAREAPCT) %>%
  
  left_join(tracts_nature_avg) %>%
  
  mutate( 
          tractparks_inzip = parks_per_area * ZAREA * ZAREAPCT/100,
          tractparkarea_inzip = prop_park_area_tract * ZAREA * ZAREAPCT/100
          ) %>%
  
  group_by(ZipCode) %>%
  
  summarize(
            parks_inzip = sum(tractparks_inzip, na.rm = T),
            parkarea_inzip = sum(tractparkarea_inzip, na.rm = T),
            ZAREA = ZAREA
            ) %>%
  mutate(
          proptractparkarea_inzip = parkarea_inzip / ZAREA * 100
          )


```



```{r SubjectsPark}
subject_park_exposure <- 
  zips_of_interest %>%
  pivot_longer(
    cols = ends_with("Location"),
    names_to = "location",
    values_to = "ZipCode"
  ) %>%
  
  left_join(zip_parks)


```


```{r SummaryStats}

sum_stats <-
  subject_park_exposure %>%
  group_by(location) %>%
  summarize(
    avg_parks = mean(parks_inzip, na.rm = T),
    avg_parkarea = mean(parkarea_inzip, na.rm = T),
    avg_prop_parkarea = mean(proptractparkarea_inzip, na.rm = T))
```


```{r plotTotalParks}

total_parks_chart <-
  sum_stats %>% 
  ggplot() +
  geom_bar(
    aes(
      x = location,
      y = avg_parks,
    ),
    stat = "identity",
    fill = "chartreuse3",
    position = "dodge"
  ) +
  labs(
    x = "Location",
    y = "Parks",
    title = "Average Total Parks in Respondents Zip Codes",
  )

total_parks_chart
```


```{r plotParkArea}

total_parkarea_chart <-
  sum_stats %>% 
  ggplot() +
  geom_bar(
    aes(
      x = location,
      y = avg_parkarea,
    ),
    stat = "identity",
    fill = "chartreuse3",
    position = "dodge"
  ) +
  labs(
    x = "Location",
    y = "Park Area [m^2]",
    title = "Average Park Area in Respondents Zip Codes",
  )

total_parkarea_chart
```


```{r plotPropParkArea}

total_prop_parkarea_chart <-
  sum_stats %>% 
  ggplot() +
  geom_bar(
    aes(
      x = location,
      y = avg_prop_parkarea,
    ),
    stat = "identity",
    fill = "chartreuse3",
    position = "dodge"
  ) +
  labs(
    x = "Location",
    y = "Proportion of Zip Code Area in Parks",
    title = "Average Proportion of Park Area in Respondents Zip Codes",
  )

total_prop_parkarea_chart
```